# SSL Certificate Management

DDALAB automatically generates trusted SSL certificates during setup to eliminate browser security warnings when accessing the application over HTTPS.

## Overview

**üéâ New installations automatically get trusted certificates!**

DDALAB now automatically attempts to generate trusted SSL certificates during the setup process. This means new installations will work without browser security warnings, providing a seamless development experience right out of the box.

## Solutions Available

### 1. Trusted Certificates (Recommended) - Using mkcert

**mkcert** is a tool that creates locally trusted SSL certificates. These certificates work like production SSL certificates but only on your local machine.

**Advantages:**
- ‚úÖ No browser security warnings
- ‚úÖ Works exactly like production SSL
- ‚úÖ Easy to set up and maintain
- ‚úÖ Automatically trusted by all browsers
- ‚úÖ Perfect for development environments

**Requirements:**
- mkcert must be installed on your system

### 2. Self-Signed Certificates (Fallback)

Traditional self-signed certificates that require manual browser acceptance.

**Disadvantages:**
- ‚ö†Ô∏è Browser security warnings
- ‚ö†Ô∏è Must manually accept certificate in each browser
- ‚ö†Ô∏è Users may be confused by security warnings

## Automatic Setup Process

**For new installations:**
1. DDALAB setup automatically detects if mkcert is available
2. If mkcert is found: Generates trusted certificates (no browser warnings)
3. If mkcert is not found: Attempts to install mkcert via Homebrew (macOS)
4. If installation succeeds: Generates trusted certificates
5. If installation fails: Falls back to self-signed certificates with user notification

**Progress messages you'll see:**
- ‚úÖ "Trusted SSL certificates generated successfully"
- ‚ö†Ô∏è "Self-signed certificates generated (browsers will show security warnings)"

## Manual Management

### Via Config Manager UI

1. Open DDALAB Config Manager
2. Go to the **Configuration** tab
3. Click **üîí Manage SSL Certificates**
4. If mkcert is not installed, click **üì¶ Install mkcert**
5. Click **üîí Generate Trusted Certificates**

### Manual Installation

#### macOS (Homebrew)
```bash
brew install mkcert
```

#### Linux (Ubuntu/Debian)
```bash
sudo apt install mkcert
```

#### Windows (Chocolatey)
```bash
choco install mkcert
```

#### Manual Download
Download from: https://github.com/FiloSottile/mkcert/releases

### Command Line Usage

You can also use the provided script:

```bash
cd /path/to/DDALAB
./scripts/generate-certs.sh
```

## How It Works

### mkcert Process

1. **Root CA Installation**: mkcert installs a local root Certificate Authority (CA) in your system's trust store
2. **Certificate Generation**: Creates SSL certificates signed by the local CA
3. **Domain Coverage**: Certificates cover:
   - `localhost`
   - `127.0.0.1`
   - `::1` (IPv6 localhost)
   - `ddalab.local`
   - `*.ddalab.local`
   - `host.docker.internal`

### Certificate Location

Certificates are stored in:
```
/path/to/your/ddalab/setup/certs/
‚îú‚îÄ‚îÄ server.crt  (SSL certificate)
‚îî‚îÄ‚îÄ server.key  (Private key)
```

## Traefik Configuration

DDALAB's Traefik configuration automatically uses the certificates from the `certs` directory:

```yaml
# traefik.yml
tls:
  stores:
    default:
      defaultCertificate:
        certFile: "/etc/traefik/certs/server.crt"
        keyFile: "/etc/traefik/certs/server.key"
```

## Certificate Management Features

### In the Config Manager UI

- **Certificate Status**: View current certificate information
- **Expiry Monitoring**: See when certificates expire
- **Trust Status**: Check if certificates are locally trusted
- **Domain Coverage**: View which domains are covered
- **One-Click Generation**: Generate new certificates easily

### Automatic Renewal

Certificates generated by mkcert are valid for 1 year. The system will warn you when certificates are about to expire (within 30 days).

## Troubleshooting

### Browser Still Shows Warnings

1. **Clear browser cache**: Browsers cache certificate information
2. **Restart browser**: Some browsers need a restart after certificate changes
3. **Check certificate dates**: Ensure certificates haven't expired
4. **Verify domain**: Make sure you're accessing via `https://localhost`

### mkcert Installation Issues

1. **Homebrew not found**: Install Homebrew first on macOS
2. **Permission denied**: Ensure you have admin privileges
3. **PATH issues**: Restart terminal after installation

### Docker Container Issues

1. **Certificate not found**: Ensure certificates exist in `/path/to/ddalab/certs/`
2. **Permission errors**: Check file permissions (644 for .crt, 600 for .key)
3. **Restart required**: Restart DDALAB services after certificate changes

## Security Considerations

### Local Development Only

- mkcert certificates are **only trusted on your local machine**
- They will **not work** in production environments
- The local CA is **not trusted** by other machines

### Production Deployment

For production, use:
- Let's Encrypt certificates
- Commercial SSL certificates
- Cloud provider SSL certificates

### Root CA Security

- mkcert creates a local root CA in your system trust store
- This CA can only create certificates for local development
- Remove with: `mkcert -uninstall`

## API Reference

The certificate management system provides the following APIs:

```typescript
// Check if mkcert is available
await electronAPI.checkMkcertAvailable(): Promise<boolean>

// Install mkcert (macOS only)
await electronAPI.installMkcert(): Promise<{success: boolean, error?: string}>

// Get certificate information
await electronAPI.getCertificateInfo(certsDir: string): Promise<CertificateInfo>

// Generate trusted certificates
await electronAPI.generateTrustedCertificates(certsDir: string): Promise<{success: boolean, error?: string}>

// Generate self-signed certificates (fallback)
await electronAPI.generateSelfSignedCertificates(certsDir: string): Promise<{success: boolean, error?: string}>

// Check if renewal is needed
await electronAPI.checkCertificatesNeedRenewal(certsDir: string): Promise<boolean>
```

## Command Line Reference

### Generate certificates manually:
```bash
# Navigate to DDALAB directory
cd /path/to/DDALAB

# Make script executable (if not already)
chmod +x scripts/generate-certs.sh

# Run certificate generation
./scripts/generate-certs.sh
```

### Check certificate information:
```bash
# View certificate details
openssl x509 -in certs/server.crt -text -noout

# Check certificate validity
openssl x509 -in certs/server.crt -checkend 86400 -noout
```

## Best Practices

1. **Use trusted certificates**: Always prefer mkcert over self-signed certificates
2. **Monitor expiry**: Check certificate expiry dates regularly
3. **Restart services**: Restart DDALAB after certificate changes
4. **Backup certificates**: Keep backups of working certificates
5. **Document changes**: Note when certificates are regenerated

## Support

If you encounter issues with SSL certificates:

1. Check the certificate status in the Config Manager
2. Try regenerating certificates
3. Restart DDALAB services
4. Clear browser cache
5. Check system logs for certificate-related errors

For more advanced troubleshooting, examine the application logs in the Config Manager's logs section.
